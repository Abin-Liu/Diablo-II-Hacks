//////////////////////////////////////////////////////////////////////
// D2Town.h: interface of the CD2Town class.
//////////////////////////////////////////////////////////////////////

#ifndef __D2TOWN_H__
#define __D2TOWN_H__

#include "..\\D2Lib\\D2Lib.h"

///////////////////////////////////////////////////////////////////////
// CD2Town Class Definition
///////////////////////////////////////////////////////////////////////
class CD2Town : public CD2Abstract
{
public:

	///////////////////////////////////////////////////////////////////////
	// Constructor(s) & destructor
	///////////////////////////////////////////////////////////////////////
	CD2Town();
	virtual ~CD2Town();

	///////////////////////////////////////////////////////////////////////
	// Client Entries
	///////////////////////////////////////////////////////////////////////
	virtual void OnGameJoin(const THISGAMESTRUCT* pGame);
	virtual void OnGameLeave();
	virtual void OnGamePacketBeforeReceived(const BYTE* aPacket, DWORD aLen);
	virtual void OnGamePacketBeforeSent(const BYTE* aPacket, DWORD aLen);
	virtual void OnGameTimerTick();

	///////////////////////////////////////////////////////////////////////
	// Public Attributes
	///////////////////////////////////////////////////////////////////////
	const CD2Unit* GetCurrentTownHealer() const;
	const CD2StaticObject* GetCurrentTownWP() const;
	BOOL IsHealer(const CD2Unit* pNpc) const;
	BOOL IsAct1Visited() const;
	BOOL IsAct1WPHigh() const; // act1 wp can spawn at 2 different locations, high or low
	D2POSITION GetAct1WPPos() const;
	D2POSITION GetAct1StashPos() const;
	D2POSITION GetAct1RelativePosition(int nOffsetX, int nOffsetY) const;
	static BYTE GetStashAct(LPARAM lParam); // from stash's location knowing the act
	BOOL IsPlayerAtStartPosition(const CD2Player* pPlayer, WORD wMaxOffset) const;

	///////////////////////////////////////////////////////////////////////
	// Public Operations
	///////////////////////////////////////////////////////////////////////

protected:
	static void CALLBACK OnA1WPMessage(UINT nMessage, WPARAM wParam, LPARAM lParam, LPVOID lpData);
	static void CALLBACK OnA1StashMessage(UINT nMessage, WPARAM wParam, LPARAM lParam, LPVOID lpData);

	///////////////////////////////////////////////////////////////////////
	// Overrides
	///////////////////////////////////////////////////////////////////////

	///////////////////////////////////////////////////////////////////////
	// Protected Operations
	///////////////////////////////////////////////////////////////////////

	///////////////////////////////////////////////////////////////////////
	// Protected Member Data
	///////////////////////////////////////////////////////////////////////
	CD2StaticObject m_aTownWPs[5];
	CD2Unit m_aHealers[5];
	CD2StaticObject m_stash;

	// Act 1 stash and wp position must be kept from vanishing
	D2POSITION m_a1StashPos;
	D2POSITION m_a1WPPos;
};

#endif // __D2TOWN_H__