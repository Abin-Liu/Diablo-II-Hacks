//////////////////////////////////////////////////////////////////////
// SyncObj.h
//
// Abin (abinn32@yahoo.com)
//////////////////////////////////////////////////////////////////////

#ifndef __SYNCOBJ_H__
#define __SYNCOBJ_H__

#include <windows.h>
#include <stdio.h>

class CSyncObj  
{
public:
	
	/////////////////////////////////////////////////////////////////
	// Constructor & Destructor
	/////////////////////////////////////////////////////////////////
	CSyncObj() { char szMutex[256] = ""; ::sprintf(szMutex, "%s%08X", "{04BB13F9-3832-44F6-A127-42C16F698226}", (DWORD)this); m_hMutex = ::CreateMutexA(NULL, FALSE, szMutex); }
	virtual ~CSyncObj() { Unlock(); ::CloseHandle(m_hMutex); }
	
	/////////////////////////////////////////////////////////////////
	// Public Operations
	/////////////////////////////////////////////////////////////////
	BOOL Lock(DWORD dwTimeout = INFINITE) const { return ::WaitForSingleObject(m_hMutex, dwTimeout) == WAIT_OBJECT_0; }
	BOOL Unlock() const { return ::ReleaseMutex(m_hMutex); }	

private:

	/////////////////////////////////////////////////////////////////
	// Private Member Data
	/////////////////////////////////////////////////////////////////
	HANDLE m_hMutex; // Mutex handle
};

#endif // __SYNCOBJ_H__
